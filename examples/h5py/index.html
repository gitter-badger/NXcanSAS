

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2.2.2. Python Examples using h5py &mdash; NeXus: Manual 3.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="NeXus: Manual 3.1 documentation" href="../../index.html" />
    <link rel="up" title="2. Examples of writing and reading NeXus data files" href="../index.html" />
    <link rel="next" title="h5py example writing the simplest NeXus data file" href="writer_1_3.html" />
    <link rel="prev" title="2.2.1. Example NeXus C programs using native HDF5 commands" href="../code_native.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="writer_1_3.html" title="h5py example writing the simplest NeXus data file"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../code_native.html" title="2.2.1. Example NeXus C programs using native HDF5 commands"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">NeXus: Manual 3.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">2. Examples of writing and reading NeXus data files</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/nexuslogo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2.2.2. Python Examples using <tt class="docutils literal"><span class="pre">h5py</span></tt></a><ul>
<li><a class="reference internal" href="#writing-the-simplest-data-using-h5py">2.2.2.1. Writing the simplest data using <tt class="docutils literal"><span class="pre">h5py</span></tt></a><ul>
</ul>
</li>
<li><a class="reference internal" href="#complete-h5py-example-writing-and-reading-a-nexus-data-file">2.2.2.2. Complete <tt class="docutils literal"><span class="pre">h5py</span></tt> example writing and reading a NeXus data file</a><ul>
<li><a class="reference internal" href="#writing-the-hdf5-file-using-h5py">Writing the HDF5 file using <strong>h5py</strong></a></li>
<li><a class="reference internal" href="#reading-the-hdf5-file-using-h5py">Reading the HDF5 file using <strong>h5py</strong></a></li>
<li><a class="reference internal" href="#validating-the-hdf5-file">Validating the HDF5 file</a></li>
<li><a class="reference internal" href="#plotting-the-hdf5-file">Plotting the HDF5 file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#links-to-data-in-external-hdf5-files">2.2.2.3. Links to Data in External HDF5 Files</a><ul>
<li><a class="reference internal" href="#file-external-angles-hdf5">file: external_angles.hdf5</a></li>
<li><a class="reference internal" href="#file-external-counts-hdf5">file: external_counts.hdf5</a></li>
<li><a class="reference internal" href="#file-external-master-hdf5">file: external_master.hdf5</a></li>
<li><a class="reference internal" href="#source-code-externalexample-py">source code: externalExample.py</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-helper-modules-for-h5py-examples">2.2.2.4. Python Helper Modules for <tt class="docutils literal"><span class="pre">h5py</span></tt> Examples</a><ul>
<li><a class="reference internal" href="#mylib-support-module"><tt class="docutils literal"><span class="pre">mylib</span></tt> support module</a></li>
<li><a class="reference internal" href="#h5totext-support-module"><tt class="docutils literal"><span class="pre">h5toText</span></tt> support module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../code_native.html"
                        title="previous chapter">2.2.1. Example NeXus C programs using native HDF5 commands</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="writer_1_3.html"
                        title="next chapter"><tt class="docutils literal"><span class="pre">h5py</span></tt> example writing the simplest NeXus data file</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/examples/h5py/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="python-examples-using-h5py">
<span id="example-h5py"></span><span id="index-0"></span><h1>2.2.2. Python Examples using <tt class="docutils literal"><span class="pre">h5py</span></tt><a class="headerlink" href="#python-examples-using-h5py" title="Permalink to this headline">¶</a></h1>
<p>One way to gain a quick familiarity with NeXus is to start working with some data. For at least the
first few examples in this section, we have a simple two-column set of 1-D data, collected as part of a
series of alignment scans by the APS USAXS instrument during the time it was stationed at
beam line 32ID. We will show how to write this
data using the Python language and the <tt class="docutils literal"><span class="pre">h5py</span></tt> package <a class="footnote-reference" href="#id3" id="id1">[1]</a>
(<span class="target" id="index-1"></span>using  <tt class="docutils literal"><span class="pre">h5py</span></tt> calls directly rather than using the NeXus NAPI). The
actual data to be written was extracted (elsewhere) from a <tt class="docutils literal"><span class="pre">spec</span></tt> <a class="footnote-reference" href="#id4" id="id2">[2]</a> data file
and read as a text block from a file by the Python source code.
Our examples will start with the simplest case and add only mild complexity with each new case
since these examples are meant for those who are unfamiliar with NeXus.</p>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><em>h5py</em>: <a class="reference external" href="http://code.google.com/p/h5py">http://code.google.com/p/h5py</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><em>SPEC</em>: <a class="reference external" href="http://certif.com/spec.html">http://certif.com/spec.html</a></td></tr>
</tbody>
</table>
<p>The data shown plotted in the next figure will be written to the NeXus HDF5 file
using the only two required NeXus objects <tt class="docutils literal"><span class="pre">NXentry</span></tt> and <tt class="docutils literal"><span class="pre">NXdata</span></tt> in the first example
and then minor variations on this structure in the next two examples.  The
data model is identical to the one in the <a class="reference internal" href="../../introduction.html#fig-simple-example"><em>Introduction</em></a>
chapter except that the names will be different, as shown below:</p>
<div class="compound">
<div class="compound-first figure">
<img alt="simple data structure" src="../../_images/Simple.png" style="width: 60%;" />
<p class="caption">data structure, (from Introduction)</p>
</div>
<p class="compound-middle rubric">our h5py example</p>
<div class="compound-middle highlight-guess"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">/</span><span class="n">entry</span><span class="o">:</span><span class="n">NXentry</span>
    <span class="o">/</span><span class="n">mr_scan</span><span class="o">:</span><span class="n">NXdata</span>
       <span class="o">/</span><span class="n">mr</span> <span class="o">:</span> <span class="n">float64</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span>
       <span class="o">/</span><span class="n">I00</span> <span class="o">:</span> <span class="n">int32</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
<div class="compound-middle figure" id="example-h5py-plot">
<img alt="Example-H5py-Plot" src="../../_images/s00008.png" style="width: 80%;" />
<p class="caption">plot of our <em>mr_scan</em></p>
</div>
<p class="compound-middle rubric">two-column data for our <em>mr_scan</em></p>
<div class="compound-last highlight-guess"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span class="mf">17.92608</span>    <span class="mi">1037</span>
<span class="mf">17.92591</span>    <span class="mi">1318</span>
<span class="mf">17.92575</span>    <span class="mi">1704</span>
<span class="mf">17.92558</span>    <span class="mi">2857</span>
<span class="mf">17.92541</span>    <span class="mi">4516</span>
<span class="mf">17.92525</span>    <span class="mi">9998</span>
<span class="mf">17.92508</span>    <span class="mi">23819</span>
<span class="mf">17.92491</span>    <span class="mi">31662</span>
<span class="mf">17.92475</span>    <span class="mi">40458</span>
<span class="mf">17.92458</span>    <span class="mi">49087</span>
<span class="mf">17.92441</span>    <span class="mi">56514</span>
<span class="mf">17.92425</span>    <span class="mi">63499</span>
<span class="mf">17.92408</span>    <span class="mi">66802</span>
<span class="mf">17.92391</span>    <span class="mi">66863</span>
<span class="mf">17.92375</span>    <span class="mi">66599</span>
<span class="mf">17.92358</span>    <span class="mi">66206</span>
<span class="mf">17.92341</span>    <span class="mi">65747</span>
<span class="mf">17.92325</span>    <span class="mi">65250</span>
<span class="mf">17.92308</span>    <span class="mi">64129</span>
<span class="mf">17.92291</span>    <span class="mi">63044</span>
<span class="mf">17.92275</span>    <span class="mi">60796</span>
<span class="mf">17.92258</span>    <span class="mi">56795</span>
<span class="mf">17.92241</span>    <span class="mi">51550</span>
<span class="mf">17.92225</span>    <span class="mi">43710</span>
<span class="mf">17.92208</span>    <span class="mi">29315</span>
<span class="mf">17.92191</span>    <span class="mi">19782</span>
<span class="mf">17.92175</span>    <span class="mi">12992</span>
<span class="mf">17.92158</span>    <span class="mi">6622</span>
<span class="mf">17.92141</span>    <span class="mi">4198</span>
<span class="mf">17.92125</span>    <span class="mi">2248</span>
<span class="mf">17.92108</span>    <span class="mi">1321</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="writing-the-simplest-data-using-h5py">
<h2>2.2.2.1. Writing the simplest data using <tt class="docutils literal"><span class="pre">h5py</span></tt><a class="headerlink" href="#writing-the-simplest-data-using-h5py" title="Permalink to this headline">¶</a></h2>
<p>These two examples show how to write the simplest data (above).
One example writes the data directly to the <a class="reference internal" href="../../classes/base_classes/NXdata.html#nxdata"><em>NXdata</em></a> group
while the other example writes the data to <tt class="docutils literal"><span class="pre">NXinstrument/NXdetector/data</span></tt>
and then creates a soft link to that data in <tt class="docutils literal"><span class="pre">NXdata</span></tt>.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="writer_1_3.html"><tt class="docutils literal"><span class="pre">h5py</span></tt> example writing the simplest NeXus data file</a></li>
<li class="toctree-l1"><a class="reference internal" href="writer_2_1.html"><tt class="docutils literal"><span class="pre">h5py</span></tt> example writing a simple NeXus data file with links</a></li>
</ul>
</div>
</div>
<div class="section" id="complete-h5py-example-writing-and-reading-a-nexus-data-file">
<span id="example-h5py-complete"></span><h2>2.2.2.2. Complete <tt class="docutils literal"><span class="pre">h5py</span></tt> example writing and reading a NeXus data file<a class="headerlink" href="#complete-h5py-example-writing-and-reading-a-nexus-data-file" title="Permalink to this headline">¶</a></h2>
<div class="section" id="writing-the-hdf5-file-using-h5py">
<span id="example-h5py-writing"></span><h3>Writing the HDF5 file using <strong>h5py</strong><a class="headerlink" href="#writing-the-hdf5-file-using-h5py" title="Permalink to this headline">¶</a></h3>
<p>In the main code section of <a class="reference internal" href="#example-h5py-basicwriter"><em>BasicWriter.py</em></a>, a current time stamp
is written in the format of <em>ISO 8601</em>.
For simplicity of this code example, we use a text string for the time, rather than
computing it directly from Python support library calls.  It is easier this way to
see the exact type of string formatting for the time.  When using the Python
<tt class="docutils literal"><span class="pre">datatime</span></tt> package, one way to write the time stamp is:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">timestamp</span> <span class="o">=</span> <span class="s">&quot;T&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The data (<tt class="docutils literal"><span class="pre">mr</span></tt> is similar to &#8220;two_theta&#8221; and
<tt class="docutils literal"><span class="pre">I00</span></tt> is similar to &#8220;counts&#8221;) is collated into two Python lists. We use our <tt class="docutils literal"><span class="pre">my_lib</span></tt>
support to read the file and parse the two-column format.</p>
<p>The new HDF5 file is opened (and created if not already existing) for writing,
setting common NeXus attributes in the same command from our support library.
Proper HDF5+NeXus groups are created for <tt class="docutils literal"><span class="pre">/entry:NXentry/mr_scan:NXdata</span></tt>.
Since we are not using the NAPI, our
support library must create and set the <tt class="docutils literal"><span class="pre">NX_class</span></tt> attribute on each group.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We want to create the desired structure of
<tt class="docutils literal"><span class="pre">/entry:NXentry/mr_scan:NXdata/</span></tt>.
First, our support library calls
<tt class="docutils literal"><span class="pre">nxentry</span> <span class="pre">=</span> <span class="pre">f.create_group(&quot;entry&quot;)</span></tt>
to create the <tt class="docutils literal"><span class="pre">NXentry</span></tt> group called
<tt class="docutils literal"><span class="pre">entry</span></tt> at the root level. Then, it calls
<tt class="docutils literal"><span class="pre">nxdata</span> <span class="pre">=</span> <span class="pre">nxentry.create_group(&quot;mr_scan&quot;)</span></tt>
to create the <tt class="docutils literal"><span class="pre">NXentry</span></tt> group called
<tt class="docutils literal"><span class="pre">entry</span></tt> as a child of the <tt class="docutils literal"><span class="pre">NXentry</span></tt> group.</p>
</div>
<p>Next, we create a dataset called <tt class="docutils literal"><span class="pre">title</span></tt> to hold a title string that can
appear on the default plot.</p>
<p>Next, we create datasets for <tt class="docutils literal"><span class="pre">mr</span></tt> and <tt class="docutils literal"><span class="pre">I00</span></tt> using our support library.
The data type of each, as represented in <tt class="docutils literal"><span class="pre">numpy</span></tt>, will be recognized by
<tt class="docutils literal"><span class="pre">h5py</span></tt> and automatically converted to the proper HDF5 type in the file.
A Python dictionary of attributes is given, specifying the engineering units and other
values needed by NeXus to provide a default plot of this data.  By setting <tt class="docutils literal"><span class="pre">signal=1</span></tt>
as an attribute on <tt class="docutils literal"><span class="pre">I00</span></tt>, NeXus recognizes <tt class="docutils literal"><span class="pre">I00</span></tt> as the default
<em>y</em> axis for the plot.  The <tt class="docutils literal"><span class="pre">axes=&quot;mr&quot;</span></tt> connects the dataset
to be used as the <em>x</em> axis.</p>
<p>Finally, we <em>must</em> remember to call <tt class="docutils literal"><span class="pre">f.close()</span></tt> or we might
corrupt the file when the program quits.</p>
<div class="compound">
<p class="compound-first rubric"><em>BasicWriter.py</em>: Write a NeXus HDF5 file using Python with h5py</p>
<div class="compound-last highlight-guess" id="example-h5py-basicwriter"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="sd">&#39;&#39;&#39;Writes a NeXus HDF5 file using h5py and numpy&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">h5py</span>    <span class="c"># HDF5 support</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">my_lib</span>  <span class="c"># uses h5py</span>

<span class="k">print</span> <span class="s">&quot;Write a NeXus HDF5 file&quot;</span>
<span class="n">fileName</span> <span class="o">=</span> <span class="s">&quot;prj_test.nexus.hdf5&quot;</span>
<span class="n">timestamp</span> <span class="o">=</span> <span class="s">&quot;2010-10-18T17:17:04-0500&quot;</span>

<span class="c"># load data from two column format</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="kp">loadtxt</span><span class="p">(</span><span class="s">&#39;input.dat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">mr_arr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">i00_arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="kp">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;int32&#39;</span><span class="p">)</span>

<span class="c"># create the HDF5 NeXus file</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">my_lib</span><span class="o">.</span><span class="n">makeFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">fileName</span><span class="p">,</span>
        <span class="n">file_time</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span>
        <span class="n">instrument</span><span class="o">=</span><span class="s">&quot;APS USAXS at 32ID-B&quot;</span><span class="p">,</span>
        <span class="n">creator</span><span class="o">=</span><span class="s">&quot;BasicWriter.py&quot;</span><span class="p">,</span>
        <span class="n">NeXus_version</span><span class="o">=</span><span class="s">&quot;4.3.0&quot;</span><span class="p">,</span>
        <span class="n">HDF5_Version</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">hdf5_version</span><span class="p">,</span>
        <span class="n">h5py_version</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>

<span class="n">nxentry</span> <span class="o">=</span> <span class="n">my_lib</span><span class="o">.</span><span class="n">makeGroup</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;entry&quot;</span><span class="p">,</span> <span class="s">&quot;NXentry&quot;</span><span class="p">)</span>
<span class="n">my_lib</span><span class="o">.</span><span class="n">makeDataset</span><span class="p">(</span><span class="n">nxentry</span><span class="p">,</span> <span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s">&#39;1-D scan of I00 v. mr&#39;</span><span class="p">)</span>

<span class="n">nxdata</span> <span class="o">=</span> <span class="n">my_lib</span><span class="o">.</span><span class="n">makeGroup</span><span class="p">(</span><span class="n">nxentry</span><span class="p">,</span> <span class="s">&quot;mr_scan&quot;</span><span class="p">,</span> <span class="s">&quot;NXdata&quot;</span><span class="p">)</span>

<span class="n">my_lib</span><span class="o">.</span><span class="n">makeDataset</span><span class="p">(</span><span class="n">nxdata</span><span class="p">,</span>  <span class="s">&quot;mr&quot;</span><span class="p">,</span>  <span class="n">mr_arr</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;degrees&#39;</span><span class="p">,</span> 
                   <span class="n">long_name</span><span class="o">=</span><span class="s">&#39;USAXS mr (degrees)&#39;</span><span class="p">)</span>

<span class="n">my_lib</span><span class="o">.</span><span class="n">makeDataset</span><span class="p">(</span><span class="n">nxdata</span><span class="p">,</span>  <span class="s">&quot;I00&quot;</span><span class="p">,</span>  <span class="n">i00_arr</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;counts&#39;</span><span class="p">,</span>
      <span class="n">signal</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>          <span class="c"># Y axis of default plot</span>
      <span class="n">axes</span><span class="o">=</span><span class="s">&#39;mr&#39;</span><span class="p">,</span>         <span class="c"># name &quot;mr&quot; as X axis</span>
      <span class="n">long_name</span><span class="o">=</span><span class="s">&#39;USAXS I00 (counts)&#39;</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>   <span class="c"># be CERTAIN to close the file</span>

<span class="k">print</span> <span class="s">&quot;wrote file:&quot;</span><span class="p">,</span> <span class="n">fileName</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="reading-the-hdf5-file-using-h5py">
<span id="example-h5py-reading"></span><h3>Reading the HDF5 file using <strong>h5py</strong><a class="headerlink" href="#reading-the-hdf5-file-using-h5py" title="Permalink to this headline">¶</a></h3>
<p>The file reader, <a class="reference internal" href="#example-h5py-reader"><em>BasicReader.py</em></a>,
is very simple since the bulk of the work is done by <tt class="docutils literal"><span class="pre">h5py</span></tt>.
Our code opens the HDF5 we wrote above,
prints the HDF5 attributes from the file, reads the two datasets,
and then prints them out as columns.  As simple as that.
Of course, real code might add some error-handling and
extracting other useful stuff from the file.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See that we identified each of the two datasets using HDF5 absolute path references
(just using the group and dataset names). Also, while coding this example, we were reminded
that HDF5 is sensitive to upper or lowercase. That is, <tt class="docutils literal"><span class="pre">I00</span></tt> is not the same is
<tt class="docutils literal"><span class="pre">i00</span></tt>.</p>
</div>
<div class="compound">
<p class="compound-first rubric"><em>BasicReader.py</em>: Read a NeXus HDF5 file using Python with h5py</p>
<div class="compound-last highlight-guess" id="example-h5py-reader"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="sd">&#39;&#39;&#39;Reads NeXus HDF5 files using h5py and prints the contents&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">h5py</span>    <span class="c"># HDF5 support</span>

<span class="n">fileName</span> <span class="o">=</span> <span class="s">&quot;prj_test.nexus.hdf5&quot;</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span>  <span class="s">&quot;r&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="kp">item</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">print</span> <span class="kp">item</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="kp">item</span><span class="p">]</span>
<span class="n">mr</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;/entry/mr_scan/mr&#39;</span><span class="p">]</span>
<span class="n">i00</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;/entry/mr_scan/I00&#39;</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&quot;#&quot;</span><span class="p">,</span> <span class="s">&quot;mr&quot;</span><span class="p">,</span> <span class="s">&quot;I00&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mr</span><span class="p">)):</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%g</span><span class="se">\t</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mr</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">i00</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Output from <tt class="docutils literal"><span class="pre">BasicReader.py</span></tt> is shown next.</p>
<div class="compound">
<p class="compound-first rubric">Output from <tt class="docutils literal"><span class="pre">BasicReader.py</span></tt></p>
<div class="compound-last highlight-text"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre>file_name: prj_test.nexus.hdf5
file_time: 2010-10-18T17:17:04-0500
creator: BasicWriter.py
HDF5_Version: 1.8.5
NeXus_version: 4.3.0
h5py_version: 1.2.1
instrument: APS USAXS at 32ID-B
#   mr  I00
0   17.9261 1037
1   17.9259 1318
2   17.9258 1704
3   17.9256 2857
4   17.9254 4516
5   17.9252 9998
6   17.9251 23819
7   17.9249 31662
8   17.9247 40458
9   17.9246 49087
10  17.9244 56514
11  17.9243 63499
12  17.9241 66802
13  17.9239 66863
14  17.9237 66599
15  17.9236 66206
16  17.9234 65747
17  17.9232 65250
18  17.9231 64129
19  17.9229 63044
20  17.9228 60796
21  17.9226 56795
22  17.9224 51550
23  17.9222 43710
24  17.9221 29315
25  17.9219 19782
26  17.9217 12992
27  17.9216 6622
28  17.9214 4198
29  17.9213 2248
30  17.9211 1321
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="validating-the-hdf5-file">
<span id="example-h5py-validation"></span><h3>Validating the HDF5 file<a class="headerlink" href="#validating-the-hdf5-file" title="Permalink to this headline">¶</a></h3>
<p>Now we have an HDF5 file that contains our data.  What makes
this different from a NeXus data file?  A NeXus file
has a specific arrangement of groups and datasets
in an HDF5 file.</p>
<p>To test that our HDF5 file conforms to the NeXus standard,
we use the <em class="xref std std-ref">Java-version of NXvalidate</em>.
Referring to the next figure,
we compare our HDF5 file with the rules for
generic <a class="footnote-reference" href="#id6" id="id5">[3]</a> data files (<tt class="docutils literal"><span class="pre">all.nxdl.xml</span></tt>).  The only items that have
been flagged are the &#8220;non-standard field names&#8221; <em>mr</em> and
<em>I00</em>.  Neither of these two names is
specifically named in the NeXus NXDL definition for
the <tt class="docutils literal"><span class="pre">NXdata</span></tt> base class.  As we&#8217;ll see shortly,
this is not a problem.</p>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[3]</a></td><td>generic NeXus data files: NeXus data
files for which no application-specific NXDL
applies</td></tr>
</tbody>
</table>
<div class="compound">
<div class="compound-last figure" id="fig-example-h5py-validation">
<img alt="fig-Example-H5py-Validation" src="../../_images/nxvalidate.png" style="width: 80%;" />
<p class="caption">NeXus validation of our HDF5 file</p>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that <tt class="docutils literal"><span class="pre">NXvalidate</span></tt> shows
only the first data field for <em>mr</em> and
<em>I00</em>.</p>
</div>
</div>
<div class="section" id="plotting-the-hdf5-file">
<span id="example-h5py-plotting"></span><h3>Plotting the HDF5 file<a class="headerlink" href="#plotting-the-hdf5-file" title="Permalink to this headline">¶</a></h3>
<p id="index-2">Now that we are certain our file conforms to the NeXus
standard, let&#8217;s plot it using the <tt class="docutils literal"><span class="pre">NeXpy</span></tt> <a class="footnote-reference" href="#id8" id="id7">[4]</a>
client tool.  To help label the plot, we added the
<tt class="docutils literal"><span class="pre">long_name</span></tt> attributes to each of our datasets.
We also added metadata to the root level of our HDF5 file
similar to that written by the NAPI.  It seemed to be a useful addition.
Compare this with
<a class="reference internal" href="#example-h5py-plot"><em>plot of our mr_scan</em></a>
and note that the horizontal axis of this plot is mirrored from that above.
This is because the data is stored in the file in descending
<tt class="docutils literal"><span class="pre">mr</span></tt> order and <tt class="docutils literal"><span class="pre">NeXpy</span></tt> has plotted
it that way by default.</p>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[4]</a></td><td><em>NeXpy</em>:    <a class="reference external" href="http://nexpy.github.io/nexpy/">http://nexpy.github.io/nexpy/</a></td></tr>
</tbody>
</table>
<div class="compound">
<div class="compound-last figure" id="fig-example-h5py-nexpy-plot">
<img alt="fig-Example-H5py-nexpy-plot" src="../../_images/nexpy.png" style="width: 80%;" />
<p class="caption">plot of our <em>mr_scan</em> using NeXpy</p>
</div>
</div>
</div>
</div>
<div class="section" id="links-to-data-in-external-hdf5-files">
<span id="h5py-example-external-links"></span><h2>2.2.2.3. Links to Data in External HDF5 Files<a class="headerlink" href="#links-to-data-in-external-hdf5-files" title="Permalink to this headline">¶</a></h2>
<p>HDF5 files may contain links to data (or groups) in other files.
This can be used to advantage to refer to data in existing HDF5 files
and create NeXus-compliant data files.  Here, we show such an example,
using the same <tt class="docutils literal"><span class="pre">counts</span></tt> v. <tt class="docutils literal"><span class="pre">two_theta</span></tt> data from the examples above.</p>
<div class="section" id="file-external-angles-hdf5">
<h3>file: external_angles.hdf5<a class="headerlink" href="#file-external-angles-hdf5" title="Permalink to this headline">¶</a></h3>
<p>Take for example, the structure of <a class="reference download internal" href="../../_downloads/external_angles.hdf5"><tt class="xref download docutils literal"><span class="pre">external_angles.hdf5</span></tt></a>,
a simple HDF5 data file that contains just the <tt class="docutils literal"><span class="pre">two_theta</span></tt>
angles in an HDF5 dataset at the root level of the file.
Although this is a valid HDF5 data file, it is not a valid NeXus data file:</p>
<div class="highlight-guess"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre>    <span class="nl">angles:</span><span class="n">float64</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">17.926079999999999</span><span class="p">,</span> <span class="err">&#39;</span><span class="p">...</span><span class="err">&#39;</span><span class="p">,</span> <span class="mf">17.92108</span><span class="p">]</span>
      <span class="err">@</span><span class="n">units</span> <span class="o">=</span> <span class="n">degrees</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="file-external-counts-hdf5">
<h3>file: external_counts.hdf5<a class="headerlink" href="#file-external-counts-hdf5" title="Permalink to this headline">¶</a></h3>
<p>The data in the file <tt class="docutils literal"><span class="pre">external_angles.hdf5</span></tt> might be referenced from
another HDF5 file (such as <a class="reference download internal" href="../../_downloads/external_counts.hdf5"><tt class="xref download docutils literal"><span class="pre">external_counts.hdf5</span></tt></a>)
by an HDF5 external link. <a class="footnote-reference" href="#id10" id="id9">[5]</a>
Here is an example of the structure</p>
<div class="highlight-guess"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre>    <span class="nl">entry:</span><span class="n">NXentry</span>
      <span class="nl">instrument:</span><span class="n">NXinstrument</span>
        <span class="nl">detector:</span><span class="n">NXdetector</span>
          <span class="nl">counts:</span><span class="n">NX_INT32</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1037</span><span class="p">,</span> <span class="err">&#39;</span><span class="p">...</span><span class="err">&#39;</span><span class="p">,</span> <span class="mi">1321</span><span class="p">]</span>
            <span class="err">@</span><span class="n">units</span> <span class="o">=</span> <span class="n">counts</span>
            <span class="err">@</span><span class="n">signal</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="err">@</span><span class="n">axes</span> <span class="o">=</span> <span class="n">two_theta</span>
          <span class="n">two_theta</span> <span class="o">--&gt;</span> <span class="n">file</span><span class="o">=</span><span class="s">&quot;external_angles.hdf5&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&quot;/angles&quot;</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The file <tt class="docutils literal"><span class="pre">external_counts.hdf5</span></tt> is not a complete NeXus file since it does not
contain an NXdata group containing a dataset with <tt class="docutils literal"><span class="pre">signal=1</span></tt> attribute.</p>
</div>
<table class="docutils footnote" frame="void" id="id10" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[5]</a></td><td>see these URLs for further guidance on HDF5 external links:
<a class="reference external" href="http://www.hdfgroup.org/HDF5/doc/RM/RM_H5L.html#Link-CreateExternal">http://www.hdfgroup.org/HDF5/doc/RM/RM_H5L.html#Link-CreateExternal</a>,
<a class="reference external" href="http://www.h5py.org/docs-1.3/guide/group.html#external-links">http://www.h5py.org/docs-1.3/guide/group.html#external-links</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="file-external-master-hdf5">
<h3>file: external_master.hdf5<a class="headerlink" href="#file-external-master-hdf5" title="Permalink to this headline">¶</a></h3>
<p>A valid NeXus data file could be created that refers to the data in these files
without making a copy of the data files themselves.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is necessary for all
these files to be located together in the same directory for the HDF5 external file
links to work properly.`</p>
</div>
<p>To be a valid NeXus file, it must contain a <a class="reference internal" href="../../classes/base_classes/NXentry.html#nxentry"><em>NXentry</em></a> group containing a
<a class="reference internal" href="../../classes/base_classes/NXdata.html#nxdata"><em>NXdata</em></a> group containing only one dataset with the aatribute <tt class="docutils literal"><span class="pre">signal=1</span></tt>.
For the files above, it is simple to make a master file that links to
the data we desire, from structure that we create.  In <tt class="docutils literal"><span class="pre">external_counts.hdf5</span></tt> above,
see that the required attribute <tt class="docutils literal"><span class="pre">signal=1</span></tt> is already present.
Here is <a class="reference download internal" href="../../_downloads/external_master.hdf5"><tt class="xref download docutils literal"><span class="pre">external_master.hdf5</span></tt></a>, an example:</p>
<div class="highlight-guess"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre>    <span class="nl">entry:</span><span class="n">NXentry</span>
      <span class="n">instrument</span> <span class="o">--&gt;</span> <span class="n">file</span><span class="o">=</span><span class="s">&quot;external_counts.hdf5&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&quot;/entry/instrument&quot;</span>
      <span class="nl">data:</span><span class="n">NXdata</span>
        <span class="n">counts</span> <span class="o">--&gt;</span> <span class="n">file</span><span class="o">=</span><span class="s">&quot;external_counts.hdf5&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&quot;/entry/instrument/detector/counts&quot;</span>
        <span class="n">two_theta</span> <span class="o">--&gt;</span> <span class="n">file</span><span class="o">=</span><span class="s">&quot;external_angles.hdf5&quot;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&quot;/angles&quot;</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="source-code-externalexample-py">
<h3>source code: externalExample.py<a class="headerlink" href="#source-code-externalexample-py" title="Permalink to this headline">¶</a></h3>
<p>Here is the complete code of a Python program, using <tt class="docutils literal"><span class="pre">h5py</span></tt>
to write a NeXus-compliant HDF5 file with links to data in other HDF5 files.</p>
<div class="compound">
<p class="compound-first rubric"><em>externalExample.py</em>: Write using HDF5 external links</p>
<div class="compound-last highlight-guess" id="example-h5py-externalexample"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Writes a NeXus HDF5 file using h5py with links to data in other HDF5 files.</span>

<span class="sd">This example is based on ``writer_2_1``.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">my_lib</span>

<span class="n">FILE_INPUT</span> <span class="o">=</span> <span class="s">&#39;input.dat&#39;</span>
<span class="n">FILE_HDF5_MASTER</span> <span class="o">=</span> <span class="s">&#39;external_master.hdf5&#39;</span>
<span class="n">FILE_HDF5_ANGLES</span> <span class="o">=</span> <span class="s">&#39;external_angles.hdf5&#39;</span>
<span class="n">FILE_HDF5_COUNTS</span> <span class="o">=</span> <span class="s">&#39;external_counts.hdf5&#39;</span>

<span class="c">#---------------------------</span>

<span class="c"># get some data</span>
<span class="n">tthData</span><span class="p">,</span> <span class="n">countsData</span> <span class="o">=</span> <span class="n">my_lib</span><span class="o">.</span><span class="n">get2ColumnData</span><span class="p">(</span><span class="n">FILE_INPUT</span><span class="p">)</span>

<span class="c"># put the angle data in an external (non-NeXus) HDF5 data file</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">my_lib</span><span class="o">.</span><span class="n">makeFile</span><span class="p">(</span><span class="n">FILE_HDF5_ANGLES</span><span class="p">)</span>  <span class="c"># create an HDF5 file (non-NeXus)</span>
<span class="n">tth</span> <span class="o">=</span> <span class="n">my_lib</span><span class="o">.</span><span class="n">makeDataset</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;angles&quot;</span><span class="p">,</span> <span class="n">tthData</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;degrees&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>    <span class="c"># be CERTAIN to close the file</span>


<span class="c"># put the detector counts in an external NeXus HDF5 data file</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">my_lib</span><span class="o">.</span><span class="n">makeFile</span><span class="p">(</span><span class="n">FILE_HDF5_COUNTS</span><span class="p">)</span>
<span class="n">nxentry</span> <span class="o">=</span> <span class="n">my_lib</span><span class="o">.</span><span class="n">makeGroup</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;entry&#39;</span><span class="p">,</span> <span class="s">&#39;NXentry&#39;</span><span class="p">)</span>
<span class="n">nxinstrument</span> <span class="o">=</span> <span class="n">my_lib</span><span class="o">.</span><span class="n">makeGroup</span><span class="p">(</span><span class="n">nxentry</span><span class="p">,</span> <span class="s">&#39;instrument&#39;</span><span class="p">,</span> <span class="s">&#39;NXinstrument&#39;</span><span class="p">)</span>
<span class="n">nxdetector</span> <span class="o">=</span> <span class="n">my_lib</span><span class="o">.</span><span class="n">makeGroup</span><span class="p">(</span><span class="n">nxinstrument</span><span class="p">,</span> <span class="s">&#39;detector&#39;</span><span class="p">,</span> <span class="s">&#39;NXdetector&#39;</span><span class="p">)</span>
<span class="n">counts</span> <span class="o">=</span> <span class="n">my_lib</span><span class="o">.</span><span class="n">makeDataset</span><span class="p">(</span><span class="n">nxdetector</span><span class="p">,</span> <span class="s">&quot;counts&quot;</span><span class="p">,</span> <span class="n">countsData</span><span class="p">,</span> 
                   <span class="n">units</span><span class="o">=</span><span class="s">&#39;counts&#39;</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="s">&#39;two_theta&#39;</span><span class="p">)</span>
<span class="c"># make a link since &quot;two_theta&quot; has not been stored here</span>
<span class="n">my_lib</span><span class="o">.</span><span class="n">makeExternalLink</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">FILE_HDF5_ANGLES</span><span class="p">,</span> 
                        <span class="s">&#39;/angles&#39;</span><span class="p">,</span> <span class="n">nxdetector</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s">&#39;/two_theta&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># create a master NeXus HDF5 file</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">my_lib</span><span class="o">.</span><span class="n">makeFile</span><span class="p">(</span><span class="n">FILE_HDF5_MASTER</span><span class="p">)</span>
<span class="n">nxentry</span> <span class="o">=</span> <span class="n">my_lib</span><span class="o">.</span><span class="n">makeGroup</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;entry&#39;</span><span class="p">,</span> <span class="s">&#39;NXentry&#39;</span><span class="p">)</span>
<span class="n">nxdata</span> <span class="o">=</span> <span class="n">my_lib</span><span class="o">.</span><span class="n">makeGroup</span><span class="p">(</span><span class="n">nxentry</span><span class="p">,</span> <span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="s">&#39;NXdata&#39;</span><span class="p">)</span>
<span class="n">my_lib</span><span class="o">.</span><span class="n">makeExternalLink</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">FILE_HDF5_ANGLES</span><span class="p">,</span> 
                        <span class="s">&#39;/angles&#39;</span><span class="p">,</span> <span class="n">nxdata</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s">&#39;/two_theta&#39;</span><span class="p">)</span>
<span class="n">my_lib</span><span class="o">.</span><span class="n">makeExternalLink</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">FILE_HDF5_COUNTS</span><span class="p">,</span> 
                        <span class="s">&#39;/entry/instrument/detector/counts&#39;</span><span class="p">,</span> 
                        <span class="n">nxdata</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s">&#39;/counts&#39;</span><span class="p">)</span>
<span class="n">my_lib</span><span class="o">.</span><span class="n">makeExternalLink</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">FILE_HDF5_COUNTS</span><span class="p">,</span> 
                        <span class="s">&#39;/entry/instrument&#39;</span><span class="p">,</span> 
                        <span class="n">nxentry</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s">&#39;/instrument&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
<div class="section" id="python-helper-modules-for-h5py-examples">
<span id="h5py-example-helpers"></span><h2>2.2.2.4. Python Helper Modules for <tt class="docutils literal"><span class="pre">h5py</span></tt> Examples<a class="headerlink" href="#python-helper-modules-for-h5py-examples" title="Permalink to this headline">¶</a></h2>
<p>Two additional Python modules were used to describe these <tt class="docutils literal"><span class="pre">h5py</span></tt> examples.
The source code for each is given here.  The first is a library we wrote that helps us
create standard NeXus components using <tt class="docutils literal"><span class="pre">h5py</span></tt>.  The second is a tool that helps
us inspect the content and structure of HDF5 files.</p>
<div class="section" id="mylib-support-module">
<span id="h5py-example-my-lib"></span><h3><tt class="docutils literal"><span class="pre">mylib</span></tt> support module<a class="headerlink" href="#mylib-support-module" title="Permalink to this headline">¶</a></h3>
<p>The examples in this section make use of
a small helper library that calls <tt class="docutils literal"><span class="pre">h5py</span></tt> to create the
various NeXus data components of
<a class="reference internal" href="../../design.html#design-groups"><em>Data Groups</em></a>,
<a class="reference internal" href="../../design.html#design-fields"><em>Data Fields</em></a>,
<a class="reference internal" href="../../design.html#design-attributes"><em>Data Attributes</em></a>, and
<a class="reference internal" href="../../design.html#design-links"><em>Links</em></a>.
In a smaller sense, this subroutine library (<tt class="docutils literal"><span class="pre">my_lib</span></tt>) fills the role of the NAPI for writing
the data using h5py.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">my_lib: routines to support reading &amp; writing NeXus HDF5 files using h5py</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">h5py</span>    <span class="c"># HDF5 support</span>
<span class="kn">import</span> <span class="nn">numpy</span>   <span class="c"># in this case, provides data structures</span>

<span class="k">def</span> <span class="nf">makeFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">attr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    create and open an empty NeXus HDF5 file using h5py</span>
<span class="sd">    </span>
<span class="sd">    Any named parameters in the call to this method will be saved as</span>
<span class="sd">    attributes of the root of the file.</span>
<span class="sd">    Note that **attr is a dictionary of named parameters.</span>

<span class="sd">    :param str filename: valid file name</span>
<span class="sd">    :param attr: optional keywords of attributes</span>
<span class="sd">    :return: h5py file object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">addAttributes</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span>

<span class="k">def</span> <span class="nf">makeGroup</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">nxclass</span><span class="p">,</span> <span class="o">**</span><span class="n">attr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    create a NeXus group</span>
<span class="sd">    </span>
<span class="sd">    Any named parameters in the call to this method </span>
<span class="sd">    will be saved as attributes of the group.</span>
<span class="sd">    Note that **attr is a dictionary of named parameters.</span>

<span class="sd">    :param obj parent: parent group</span>
<span class="sd">    :param str name: valid NeXus group name</span>
<span class="sd">    :param str nxclass: valid NeXus class name</span>
<span class="sd">    :param attr: optional keywords of attributes</span>
<span class="sd">    :return: h5py group object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&quot;NX_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nxclass</span>
    <span class="n">addAttributes</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span>

<span class="k">def</span> <span class="nf">makeDataset</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    create and write data to a dataset in the HDF5 file hierarchy</span>
<span class="sd">    </span>
<span class="sd">    Any named parameters in the call to this method </span>
<span class="sd">    will be saved as attributes of the dataset.</span>

<span class="sd">    :param obj parent: parent group</span>
<span class="sd">    :param str name: valid NeXus dataset name</span>
<span class="sd">    :param obj data: the data to be saved</span>
<span class="sd">    :param attr: optional keywords of attributes</span>
<span class="sd">    :return: h5py dataset object</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">addAttributes</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span>

<span class="k">def</span> <span class="nf">makeLink</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">sourceObject</span><span class="p">,</span> <span class="n">targetName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    create an internal NeXus (hard) link in an HDF5 file</span>

<span class="sd">    :param obj parent: parent group of source</span>
<span class="sd">    :param obj sourceObject: existing HDF5 object</span>
<span class="sd">    :param str targetName: HDF5 node path to be created, </span>
<span class="sd">                            such as ``/entry/data/data``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;target&#39;</span> <span class="ow">in</span> <span class="n">sourceObject</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
        <span class="c"># NeXus link, NOT an HDF5 link!</span>
        <span class="n">sourceObject</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&quot;target&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sourceObject</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">parent</span><span class="o">.</span><span class="n">_id</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sourceObject</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">targetName</span><span class="p">,</span> <span class="n">h5py</span><span class="o">.</span><span class="n">h5g</span><span class="o">.</span><span class="n">LINK_HARD</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">makeExternalLink</span><span class="p">(</span><span class="n">hdf5FileObject</span><span class="p">,</span> <span class="n">sourceFile</span><span class="p">,</span> <span class="n">sourcePath</span><span class="p">,</span> <span class="n">targetPath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    create an external link from sourceFile, sourcePath to targetPath in hdf5FileObject</span>

<span class="sd">    :param obj hdf5FileObject: open HDF5 file object</span>
<span class="sd">    :param str sourceFile: file containing existing HDF5 object at sourcePath</span>
<span class="sd">    :param str sourcePath: path to existing HDF5 object in sourceFile</span>
<span class="sd">    :param str targetPath: full node path to be created in current open HDF5 file, </span>
<span class="sd">                            such as ``/entry/data/data``</span>
<span class="sd">                            </span>
<span class="sd">    .. note::</span>
<span class="sd">       Since the object retrieved is in a different file, </span>
<span class="sd">       its &quot;.file&quot; and &quot;.parent&quot; properties will refer to </span>
<span class="sd">       objects in that file, not the file in which the link resides.</span>

<span class="sd">    .. see:: http://www.h5py.org/docs-1.3/guide/group.html#external-links</span>
<span class="sd">    </span>
<span class="sd">    This routine is provided as a reminder how to do this simple operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hdf5FileObject</span><span class="p">[</span><span class="n">targetPath</span><span class="p">]</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">ExternalLink</span><span class="p">(</span><span class="n">sourceFile</span><span class="p">,</span> <span class="n">sourcePath</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">addAttributes</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    add attributes to an h5py data item</span>

<span class="sd">    :param obj parent: h5py parent object</span>
<span class="sd">    :param dict attr: dictionary of attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">attr</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">({}):</span>
        <span class="c"># attr is a dictionary of attributes</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attr</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

<span class="k">def</span> <span class="nf">get2ColumnData</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    read two-column data from a file, </span>
<span class="sd">    first column is float, </span>
<span class="sd">    second column is integer</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">buffer</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">xArr</span> <span class="o">=</span> <span class="nb">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yArr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;int32&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xArr</span><span class="p">,</span> <span class="n">yArr</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="h5totext-support-module">
<span id="h5py-example-h5totext"></span><h3><tt class="docutils literal"><span class="pre">h5toText</span></tt> support module<a class="headerlink" href="#h5totext-support-module" title="Permalink to this headline">¶</a></h3>
<p>The module <tt class="docutils literal"><span class="pre">h5toText</span></tt> reads an HDF5 data file and prints out the
structure of the groups, datasets, attributes, and links in that file.
There is a command-line option to print out more or less of the data
in the dataset arrays.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Print the structure of an HDF5 file to stdout</span>
<span class="sd">&#39;&#39;&#39;</span>


<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">getopt</span>


<span class="k">class</span> <span class="nc">H5toText</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Example usage showing default display::</span>
<span class="sd">    </span>
<span class="sd">        mc = H5toText(filename)</span>
<span class="sd">        mc.array_items_shown = 5</span>
<span class="sd">        mc.report()</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">requested_filename</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">isNeXus</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">array_items_shown</span> <span class="o">=</span> <span class="mi">5</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">makeReport</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Constructor &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requested_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isNeXus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testIsNeXus</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">makeReport</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; reporter &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNeXus</span><span class="p">:</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s">&quot;:NeXus data file&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showGroup</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">indentation</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">testIsNeXus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        test if the selected HDF5 file is a NeXus file</span>
<span class="sd">        </span>
<span class="sd">        At this time, the code only tests for the existence of</span>
<span class="sd">        the NXentry group.  The tests should be extended to require</span>
<span class="sd">        a NXdata group and a single dataset containing signal=1 attribute.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="c">#print str(type(value))</span>
                <span class="k">if</span> <span class="s">&#39;.Group&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
                    <span class="k">continue</span>
                <span class="c">#print value.attrs.keys()</span>
                <span class="k">if</span> <span class="s">&#39;NX_class&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;NX_class&#39;</span><span class="p">]</span>
                <span class="c">#print type(v), v, type(&quot;a string&quot;)</span>
                <span class="n">possible_types</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&lt;type &#39;numpy.string_&#39;&gt;&quot;</span><span class="p">,</span> <span class="p">]</span>
                <span class="n">possible_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;&lt;type &#39;str&#39;&gt;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">possible_types</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="s">&#39;NXentry&#39;</span><span class="p">):</span>
                    <span class="c"># TODO: apply more tests</span>
                    <span class="c">#    for group NXdata </span>
                    <span class="c">#    and signal=1 attribute on only one dataset</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">break</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">showGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">indentation</span> <span class="o">=</span> <span class="s">&quot;  &quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;print the contents of the group&#39;&#39;&#39;</span>
        <span class="n">nxclass</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="s">&#39;NX_class&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="n">class_attr</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;NX_class&#39;</span><span class="p">]</span>
            <span class="n">nxclass</span> <span class="o">=</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">class_attr</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">indentation</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">nxclass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showAttributes</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">indentation</span><span class="p">)</span>
        <span class="c"># show datasets and links next</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">itemname</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="n">linkref</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itemname</span><span class="p">,</span> <span class="n">getlink</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">&#39;.ExternalLink&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">linkref</span><span class="p">)):</span>
                <span class="c"># if the external file is not present, cannot know if</span>
                <span class="c"># link target is a dataset or a group or another link</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">  </span><span class="si">%s</span><span class="s"> --&gt; file=&quot;</span><span class="si">%s</span><span class="s">&quot;, path=&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span>
                <span class="k">print</span> <span class="n">fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">indentation</span><span class="p">,</span> <span class="n">itemname</span><span class="p">,</span> <span class="n">linkref</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">linkref</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">classref</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itemname</span><span class="p">,</span> <span class="n">getclass</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">itemname</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&#39;.File&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">classref</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;.Group&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">classref</span><span class="p">):</span>
                    <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s">&#39;.Dataset&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">classref</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">showDataset</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">itemname</span><span class="p">,</span> <span class="n">indentation</span><span class="o">+</span><span class="s">&quot;  &quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;unidentified </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">itemname</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">classref</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">linkref</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">msg</span>
        <span class="c"># then show things that look like groups</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
            <span class="n">itemname</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showGroup</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">itemname</span><span class="p">,</span> <span class="n">indentation</span><span class="o">+</span><span class="s">&quot;  &quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">showAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">indentation</span> <span class="o">=</span> <span class="s">&quot;  &quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;print any attributes&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">  @</span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indentation</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">showDataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dset</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">indentation</span> <span class="o">=</span> <span class="s">&quot;  &quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;print the contents and structure of a dataset&#39;&#39;&#39;</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNeXus</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&quot;target&quot;</span> <span class="ow">in</span> <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;target&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">dset</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s%s</span><span class="s"> --&gt; </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indentation</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> 
                                           <span class="n">dset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;target&#39;</span><span class="p">])</span>
                    <span class="k">return</span>
        <span class="n">txType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getType</span><span class="p">(</span><span class="n">dset</span><span class="p">)</span>
        <span class="n">txShape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getShape</span><span class="p">(</span><span class="n">dset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s">&quot; = </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">dset</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s%s</span><span class="s">:</span><span class="si">%s%s%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indentation</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">txType</span><span class="p">,</span> 
                                   <span class="n">txShape</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showAttributes</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">indentation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s%s</span><span class="s">:</span><span class="si">%s%s</span><span class="s"> = __array&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indentation</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> 
                                       <span class="n">txType</span><span class="p">,</span> <span class="n">txShape</span><span class="p">)</span>
            <span class="c"># show these before __array</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showAttributes</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">indentation</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_items_shown</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatArray</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">indentation</span> <span class="o">+</span> <span class="s">&#39;  &#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">  </span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indentation</span><span class="p">,</span> <span class="s">&quot;__array&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">  </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indentation</span><span class="p">,</span> <span class="s">&quot;__array&quot;</span><span class="p">,</span> <span class="s">&quot;not shown&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; get the storage (data) type of the dataset &#39;&#39;&#39;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;|S&#39;</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="s">&#39;char[</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isNeXus</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="s">&#39;NX_&#39;</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">t</span>

    <span class="k">def</span> <span class="nf">getShape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return the shape of the HDF5 dataset &#39;&#39;&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="p">[</span><span class="s">&#39;1&#39;</span><span class="p">]:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;[</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">formatArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">indentation</span> <span class="o">=</span> <span class="s">&#39;  &#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; nicely format an array up to rank=5 &#39;&#39;&#39;</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatNdArray</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">indentation</span> <span class="o">+</span> <span class="s">&#39;  &#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="s">&quot;### no arrays for rank &gt; 5 ###&quot;</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">decideNumShown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; determine how many values to show &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_items_shown</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_items_shown</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_items_shown</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">n</span>

    <span class="k">def</span> <span class="nf">formatNdArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">indentation</span> <span class="o">=</span> <span class="s">&#39;  &#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; return a list of lower-dimension arrays, nicely formatted &#39;&#39;&#39;</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rank</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="k">return</span> <span class="bp">None</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decideNumShown</span><span class="p">(</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">item</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatNdArray</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
            <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatNdArray</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> 
                                                    <span class="n">indentation</span> <span class="o">+</span> <span class="s">&#39;  &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatNdArray</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:],</span> 
                                                    <span class="n">indentation</span> <span class="o">+</span> <span class="s">&#39;  &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatNdArray</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:],</span> 
                                                    <span class="n">indentation</span> <span class="o">+</span> <span class="s">&#39;  &#39;</span><span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="c"># skip over most</span>
            <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;...&quot;</span><span class="p">)</span>
            <span class="c">#  get the last one</span>
            <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">item</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatNdArray</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
            <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatNdArray</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> 
                                                    <span class="n">indentation</span> <span class="o">+</span> <span class="s">&#39;  &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatNdArray</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:],</span> 
                                                    <span class="n">indentation</span> <span class="o">+</span> <span class="s">&#39;  &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatNdArray</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:],</span> 
                                                    <span class="n">indentation</span> <span class="o">+</span> <span class="s">&#39;  &#39;</span><span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">item</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span> <span class="n">r</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;[</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indentation</span> <span class="o">+</span> <span class="s">&#39;  &#39;</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indentation</span> <span class="o">+</span> <span class="s">&#39;  &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">indentation</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span>
        <span class="k">return</span> <span class="n">s</span>


<span class="k">def</span> <span class="nf">do_filelist</span><span class="p">(</span><span class="n">filelist</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    interpret the structure of a list of HDF5 files</span>
<span class="sd">    </span>
<span class="sd">    :param [str] filelist: one or more file names to be interpreted</span>
<span class="sd">    :param int limit: maximum number of array items to be shown (default = 5)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">H5toText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">array_items_shown</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="n">mc</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">do_test</span><span class="p">():</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">filelist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;th02c_ps02_1_master.h5&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;external_angles.hdf5&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;external_counts.hdf5&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;external_master.hdf5&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;../Create/example1.hdf5&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;../Create/example2.hdf5&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;../Create/example3.hdf5&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;../Create/example4.hdf5&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;../../../NeXus/definitions/trunk/manual/examples/h5py/prj_test.nexus.hdf5&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;../../../NeXus/definitions/exampledata/code/hdf5/dmc01.h5&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;../../../NeXus/definitions/exampledata/code/hdf5/dmc02.h5&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;../../../NeXus/definitions/exampledata/code/hdf5/focus2007n001335.hdf&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;../../../NeXus/definitions/exampledata/code/hdf5/NXtest.h5&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;../../../NeXus/definitions/exampledata/code/hdf5/sans2009n012333.hdf&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;../Create/simple5.nxs&#39;</span><span class="p">)</span>
    <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;../Create/bad.h5&#39;</span><span class="p">)</span>
    
    <span class="n">do_filelist</span><span class="p">(</span><span class="n">filelist</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;standard command-line interface&#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">opts</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">getopt</span><span class="o">.</span><span class="n">getopt</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s">&quot;n:&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span>
        <span class="k">print</span> <span class="s">&quot;usage: &quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot; [-n ##] HDF5_file_name [another_HDF5_file_name]&quot;</span>
        <span class="k">print</span> <span class="s">&quot;  -n ## : limit number of displayed array items to ## (must be 3 or more or &#39;None&#39;)&quot;</span>
        <span class="k">print</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;-n&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;none&quot;</span><span class="p">:</span>
                <span class="n">limit</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">do_filelist</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">main</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">do_test</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="writer_1_3.html" title="h5py example writing the simplest NeXus data file"
             >next</a> |</li>
        <li class="right" >
          <a href="../code_native.html" title="2.2.1. Example NeXus C programs using native HDF5 commands"
             >previous</a> |</li>
        <li><a href="../../index.html">NeXus: Manual 3.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >2. Examples of writing and reading NeXus data files</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../../copyright.html">Copyright</a> 2014, http://nexusformat.org.
      Last updated on 2014-10-02 14:43:08 CDT.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>